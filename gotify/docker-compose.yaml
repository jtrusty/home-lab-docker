version: '3.7'

services:
  gotify:
    hostname: gotify
    image: gotify/server
    deploy:
      placement:
        constraints: [node.role == manager]
    volumes:
      - /mnt/cephfs/gotify:/app/data
    ports:
      # Default HTTP Port
      - 8080:80/tcp
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    environment:
    # Set the appropriate timezone for your location from
      # https://en.wikipedia.org/wiki/List_of_tz_database_time_zones, e.g:
      TZ: America/Chicago
      # Set a password to access the web interface.
      GOTIFY_DEFAULTUSER_PASS: ${GOTIFY_DEFAULTUSER_PASS}

  pushtify:
    hostname: pushtify
    image: ghcr.io/sebw/pushtify:latest
    deploy:
      placement:
        constraints: [node.role == manager]
    depends_on:
      - gotify
    environment:
      GOTIFY_TOKEN: ${GOTIFY_TOKEN}
      GOTIFY_HOST: gotify
      GOTIFY_PROTOCOL: http
      PUSHOVER_USERKEY: ${PUSHOVER_USERKEY}
    restart: unless-stopped